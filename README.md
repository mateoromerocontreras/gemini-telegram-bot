
# Telegram Bot with Gemini API Integration

This project is a Telegram Bot that uses the Gemini API to generate responses to user messages. The bot is hosted on Google Cloud Functions.

## Features

- Receives messages from Telegram users.
- Uses the Gemini API to generate responses.
- Sends generated responses back to the Telegram chat.

## Setup

### Prerequisites

- Python
- pip
- Google Cloud account
- Telegram Bot Token
- Gemini API Key

### Installation

1. Clone the repository:
    ```sh
    git clone <repository-url>
    cd <repository-directory>
    ```

2. Create a virtual environment and activate it:
    ```sh
    python -m venv venv
    source venv/bin/activate
    ```

3. Install the required packages:
    ```sh
    pip install -r requirements.txt
    ```

4. Create a `.env` file in the root directory and add your credentials:
    ```dotenv
    TELEGRAM_BOT_TOKEN=your-telegram-bot-token
    GEMINI_API_KEY=your-gemini-api-key
    ```

### Deployment

1. Deploy the function to Google Cloud Functions:
    ```sh
    gcloud functions deploy telegram_webhook --runtime python39 --trigger-http --allow-unauthenticated
    ```

2. Set the webhook URL for your Telegram bot:
    ```sh
    curl -F "url=https://<your-cloud-function-url>" https://api.telegram.org/bot<your-telegram-bot-token>/setWebhook
    ```

## Usage

Once deployed, the bot will automatically handle incoming messages and respond using the Gemini API.

## Step-by-Step Setup

### STEP 1: Prerequisites
1. Google Cloud account
2. Telegram account
3. Access to Google's Gemini API
4. Python installed on your local machine

### STEP 2: Create a Telegram Bot
1. Open Telegram and search for "BotFather"
2. Send `/newbot` command
3. Follow instructions to name your bot
4. Save the HTTP API token (TELEGRAM_BOT_TOKEN) provided

### STEP 3: Get Gemini API Access
1. Go to Google AI Studio (https://makersuite.google.com/)
2. Create an API key
3. Save the API key (GEMINI_API_KEY)

### STEP 4: Project Setup
1. Create a new directory for your project
2. Create two files:
   - `main.py` (with the code above)
   - `requirements.txt` with the following content:
   ```
   functions-framework==3.*
   google-generativeai==0.*
   requests==2.*
   flask==2.*
   ```

### STEP 5: Local Testing (Optional)
1. Create a virtual environment:
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows: venv\Scripts\activate
   ```
2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```
3. Set environment variables locally:
   ```bash
   export TELEGRAM_BOT_TOKEN=your_token
   export GEMINI_API_KEY=your_key
   ```

### STEP 6: Deploy to Google Cloud
1. Install Google Cloud CLI if you haven't already
2. Authenticate with Google Cloud:
   ```bash
   gcloud auth login
   ```
3. Deploy the function:
   ```bash
   gcloud functions deploy telegram_webhook \
     --runtime python311 \
     --trigger-http \
     --allow-unauthenticated \
     --set-env-vars TELEGRAM_BOT_TOKEN=your_token,GEMINI_API_KEY=your_key
   ```
4. Copy the function URL provided after deployment

### STEP 7: Connect Telegram Webhook
1. Replace placeholders in this URL:
   ```
   https://api.telegram.org/bot<TELEGRAM_BOT_TOKEN>/setWebhook?url=<YOUR_FUNCTION_URL>
   ```
2. Visit the URL in a browser to set up the webhook

### STEP 8: Testing the Bot
1. Open your bot in Telegram
2. Send a message
3. You should receive a response generated by Gemini

### How the Flow Works:
1. User sends message to your Telegram bot
2. Telegram forwards the message to your Cloud Function
3. The function:
   - Extracts the message text
   - Sends it to Gemini API
   - Gets the generated response
   - Sends the response back to the user via Telegram

### Error Handling:
- Non-POST requests are rejected
- Non-text messages are handled gracefully
- Gemini API errors are caught and reported to the user
- General exceptions are logged and returned as JSON

## License

This project is licensed under the MIT License.
